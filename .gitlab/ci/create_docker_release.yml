push_to_ghcr:
  image: quay.io/skopeo/stable:latest
  stage: release
  tags: [docker]
  variables:
    GITHUB_USERNAME: "dhufe"  # Oder Ã¼ber CI/CD-Variable setzen
  before_script:
    - skopeo login -u "$GITHUB_USER" --password $GITHUB_TOKEN ghcr.io
    - skopeo login -u "$CI_REGISTRY_USER" --password $CI_REGISTRY_PASSWORD $CI_REGISTRY

  script:
    - |
      set -e
      
      VERSION="$CI_COMMIT_TAG"
      
      echo "ðŸ”„ Copying multi-arch image from GitLab to GHCR"
      echo "   Source: $GITLAB_IMAGE:$VERSION"
      echo "   Target: $GITHUB_IMAGE:$VERSION"
      
      # Copy mit --all fÃ¼r multi-arch support
      skopeo copy --all \
        docker://$GITLAB_IMAGE:$VERSION \
        docker://$GITHUB_IMAGE:$VERSION
      
      echo "ðŸ“Œ Tagging as latest..."
      skopeo copy --all \
        docker://$GITLAB_IMAGE:$VERSION \
        docker://$GITHUB_IMAGE:latest
      
      echo ""
      echo "âœ… Published to GHCR:"
      echo "   ðŸ“¦ $GITHUB_IMAGE:$VERSION"
      echo "   ðŸ“Œ $GITHUB_IMAGE:latest"

  rules:
    - if: '$CI_COMMIT_TAG'
  dependencies: []