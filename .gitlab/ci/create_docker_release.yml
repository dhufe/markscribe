create_github_package:
  stage: release
  image: quay.io/podman/stable
  tags: [docker]
  before_script:
    - podman login ghcr.io -u "$GITHUB_USERNAME" --password "$GITHUB_TOKEN"
  script:
    - |
      # Version bestimmen (Tag oder Fallback)
      if [ -n "$CI_COMMIT_TAG" ]; then
        VERSION=$CI_COMMIT_TAG
      else
        LAST_TAG=$(git describe --tags --abbrev=0 2>/dev/null || echo "v0.0.0")
        COMMIT_SHORT=$(git rev-parse --short=8 HEAD)
        VERSION="$LAST_TAG-$COMMIT_SHORT"
      fi

      echo "ðŸš€ Building and pushing image: ghcr.io/dhufe/markscribe:$VERSION"

      # Build & Push mit Version-Tag
      podman build -t ghcr.io/dhufe/markscribe:$VERSION .
      podman push ghcr.io/dhufe/markscribe:$VERSION
      
      podman tag ghcr.io/dhufe/markscribe:$VERSION ghcr.io/dhufe/markscribe:latest
      podman push ghcr.io/dhufe/markscribe:latest
      echo "âœ… Pushed 'latest' tag (official release)"


  # Regeln fÃ¼r AusfÃ¼hrung (Tags + manuell von main)
  rules:
    - if: $CI_COMMIT_TAG               # Automatisch fÃ¼r Tags (Releases)
    - if: $CI_COMMIT_BRANCH == "master"  # Manuell fÃ¼r main (Pre-Releases)
      when: manual

  # Variablen (sollten in GitLab CI/CD-Variablen definiert sein)
  variables:
    GITHUB_USERNAME: "dhufe"  # Oder Ã¼ber CI/CD-Variable setzen
